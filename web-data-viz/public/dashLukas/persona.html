<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale-1.0">


    <link rel="shortcut icon" href="../assets/imgs/blackscreenicon.ico" type="image/x-icon">
    <title>BlackScreen | Dashboards</title>
    <link rel="stylesheet" href="../css/dashPersona.css">
    <link rel="stylesheet" href="./../css/dashboards.css">
    <link rel="stylesheet" href="./../css/style.css" />
    <link rel="stylesheet" href="./../css/dashboardHomeAdm.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" />
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />



    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/simple-statistics/7.8.3/simple-statistics.min.js"></script>
    <script src="../js/sessao.js"></script>
    <script src="./../js/alerta.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/regression/2.0.1/regression.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="../js/leaflet-heat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

</head>

<body>

    <div class="janela">
        <div class="header-left">
            <img src="../assets/imgs/blackscreenlogo.png" alt="BlackScreen">

            <div class="hello">
                <h3>Bem vindo, <br><span id="b_usuario">usuário</span>!</h3>
            </div>

            <div class="links">
                <div class="btn-nav-white">
                    <a href="dashboard.html">
                        <span class="material-symbols-outlined">
                            home
                        </span>
                        <h3>
                            Ínicio
                        </h3>
                    </a>
                </div>

                <div class="btn-nav-white">
                    <a href="../dashboard/logAlertas.html">
                        <span class="material-symbols-outlined">
                            notifications
                        </span>
                        <h3>
                            Alertas
                        </h3>
                    </a>
                </div>

                <div class="btn-nav-white">
                    <a href="../dashboard/atm.html">
                        <span class="material-symbols-outlined">
                            local_atm
                        </span>
                        <h3>
                            ATMs
                        </h3>
                    </a>
                </div>

                <div class="btn-nav-white">
                    <a href="../dashboard/cadastroComponentes.html">
                        <span class="material-symbols-outlined">
                            health_and_safety
                        </span>
                        <h3>
                            Componentes
                        </h3>
                    </a>
                </div>



                <div class="btn-nav">
                    <a href="../dashLukas/persona.html">
                        <span class="material-symbols-outlined">
                            signal_cellular_alt
                        </span>
                        <h3>
                            Persona
                        </h3>
                    </a>
                </div>





                <div class="btn-nav-white">
                    <a href="../dashboard/insight.html">
                        <span class="material-symbols-outlined">
                            search_insights
                        </span>
                        <h3>
                            Insights
                        </h3>
                    </a>
                </div>

                <div class="btn-nav-white">
                    <a href="../dashboard/perfil.html">
                        <span class="material-symbols-outlined">
                            account_circle
                        </span>
                        <h3>
                            Meu Perfil
                        </h3>
                    </a>
                </div>
            </div>
            <div class="btn-logout" onclick="limparSessao()">
                <h3>Sair</h3>
            </div>

        </div>

        <div class="help-desk content">

            <div class="metrics-container container_Header">

                <div class="perosna-kpi">
                    <span class="material-symbols-outlined icon_kpi"><svg xmlns="http://www.w3.org/2000/svg"
                            height="48px" viewBox="0 -960 960 960" width="48px" fill="#fff">
                            <path
                                d="m24-112 456-789 456 789H24Zm140-81h632L480-740 164-193Zm319.86-50q13.72 0 22.93-9.37 9.21-9.37 9.21-22.79 0-12.42-9.39-22.13-9.39-9.71-23.1-9.71-12.72 0-22.61 9.66-9.9 9.67-9.9 22.52 0 13.42 10.07 22.62 10.07 9.2 22.79 9.2ZM455-348h57v-216h-57v216Zm25-119Z" />
                        </svg></span>
                    <div class="metric-info">
                        <h3>Alerta Por Componente</h3>
                        <div class="classCompontes">

                        </div>
                    </div>
                </div>

                <div class="perosna-kpi">
                    <span class="material_color_kpi material-symbols-outlined icon_kpi"><svg
                            xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px"
                            fill="#fff">
                            <path
                                d="M195-124v-91h64l78-254q9-30 32.46-48 23.45-18 54.54-18h113q30.71 0 53.86 18Q614-499 624-469l77 254h65v91H195Zm162-91h247l-69.5-229H425l-68 229Zm78-450v-212h91v212h-91Zm272 115-65-65 150-150 64 65-149 150Zm61 195v-91h211v91H768ZM253-550 104-700l64-65 151 150-66 65ZM-19-355v-91h212v91H-19Zm499 140Z" />
                        </svg></span>
                    <div class="metric-info">
                        <h3>Chamado Abertos</h3>
                        <div class="classCompontes_alertas"></div>
                    </div>
                </div>

                <div class="perosna-kpi">
                    <span class="atm_color material_color_kpi material-symbols-outlined icon_kpi atm">
<svg viewBox="-10.24 -10.24 1044.48 1044.48" fill="#ffffff" class="icon" version="1.1" xmlns="http://www.w3.org/2000/svg" stroke="#ffffff" stroke-width="29.695999999999998"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" stroke="#CCCCCC" stroke-width="8.192"></g><g id="SVGRepo_iconCarrier"><path d="M360.484 448.004c-4.414 0-8.076-3.578-8.076-8 0-4.42 3.5-8 7.92-8h0.156c4.422 0 8 3.578 8 8 0 4.422-3.578 8-8 8zM392.482 448.004c-4.414 0-8.076-3.578-8.076-8 0-4.42 3.5-8 7.92-8h0.156c4.422 0 8 3.578 8 8 0 4.422-3.578 8-8 8zM424.48 448.004c-4.414 0-8.076-3.578-8.076-8 0-4.42 3.5-8 7.92-8h0.156c4.422 0 8 3.578 8 8 0 4.422-3.578 8-8 8zM456.478 448.004c-4.414 0-8.076-3.578-8.076-8 0-4.42 3.5-8 7.92-8h0.156c4.422 0 8 3.578 8 8 0 4.422-3.578 8-8 8zM360.484 480.002c-4.414 0-8.076-3.578-8.076-8 0-4.42 3.5-8 7.92-8h0.156c4.422 0 8 3.578 8 8 0 4.422-3.578 8-8 8zM392.482 480.002c-4.414 0-8.076-3.578-8.076-8 0-4.42 3.5-8 7.92-8h0.156c4.422 0 8 3.578 8 8 0 4.422-3.578 8-8 8zM424.48 480.002c-4.414 0-8.076-3.578-8.076-8 0-4.42 3.5-8 7.92-8h0.156c4.422 0 8 3.578 8 8 0 4.422-3.578 8-8 8zM456.478 480.002c-4.414 0-8.076-3.578-8.076-8 0-4.42 3.5-8 7.92-8h0.156c4.422 0 8 3.578 8 8 0 4.422-3.578 8-8 8zM488.476 448.004c-4.414 0-8.076-3.578-8.076-8 0-4.42 3.5-8 7.92-8h0.156c4.422 0 8 3.578 8 8 0 4.422-3.578 8-8 8zM488.476 480.002c-4.414 0-8.076-3.578-8.076-8 0-4.42 3.5-8 7.92-8h0.156c4.422 0 8 3.578 8 8 0 4.422-3.578 8-8 8z" fill=""></path><path d="M679.988 991.97H168.02a7.994 7.994 0 0 1-7.998-8V8.032c0-4.422 3.578-8 7.998-8h511.968c4.422 0 8 3.578 8 8v975.94a7.994 7.994 0 0 1-8 7.998zM176.02 975.972h495.97V16.03H176.02v959.942z" fill=""></path><path d="M855.978 991.97h-175.99a7.994 7.994 0 0 1-7.998-8V8.032c0-4.422 3.578-8 7.998-8h175.99c4.422 0 8 3.578 8 8v975.94a7.994 7.994 0 0 1-8 7.998z m-167.99-15.998h159.99V16.03h-159.99v959.942z" fill=""></path><path d="M855.978 112.024H168.02a7.994 7.994 0 0 1-7.998-8c0-4.422 3.578-8 7.998-8h687.958c4.422 0 8 3.578 8 8 0 4.422-3.578 8-8 8zM248.016 192.02a7.976 7.976 0 0 1-5.656-2.344L194.364 141.678a8 8 0 0 1 11.31-11.312l47.998 47.998a8 8 0 0 1-5.656 13.656zM599.994 192.02a8 8 0 0 1-5.656-13.656l47.996-47.998a8 8 0 1 1 11.312 11.312l-47.996 47.998a7.974 7.974 0 0 1-5.656 2.344zM583.994 208.018h-319.98a7.994 7.994 0 0 1-7.998-8c0-4.422 3.578-8 7.998-8h319.98c4.422 0 8 3.578 8 8 0 4.422-3.578 8-8 8z" fill=""></path><path d="M599.978 416.006a7.98 7.98 0 0 1-7.954-7.39l-16-207.986a7.976 7.976 0 0 1 7.36-8.578c4-0.766 8.25 2.938 8.578 7.36l16 207.986a7.976 7.976 0 0 1-7.36 8.578c-0.202 0.03-0.404 0.03-0.624 0.03zM248.024 416.006c-0.204 0-0.414 0-0.624-0.032a7.986 7.986 0 0 1-7.36-8.578l16-207.986c0.336-4.406 3.968-8.078 8.592-7.36a7.986 7.986 0 0 1 7.36 8.578l-15.998 207.986a8 8 0 0 1-7.97 7.392z" fill=""></path><path d="M599.994 416.006H248.016c-4.422 0-8-3.578-8-8 0-4.42 3.578-8 8-8h351.978c4.422 0 8 3.578 8 8 0 4.422-3.578 8-8 8zM200.01 480.002a7.992 7.992 0 0 1-6.646-12.436l31.998-47.998a7.98 7.98 0 0 1 11.092-2.218 7.992 7.992 0 0 1 2.218 11.092l-31.998 47.998a7.99 7.99 0 0 1-6.664 3.562z" fill=""></path><path d="M312.02 496a7.998 7.998 0 0 1-7.766-9.936l16-63.996c1.062-4.296 5.374-6.86 9.694-5.828a8 8 0 0 1 5.82 9.704l-15.998 63.996a7.986 7.986 0 0 1-7.75 6.06zM535.998 496a8 8 0 0 1-7.766-6.062l-15.99-63.996a8.002 8.002 0 0 1 5.818-9.704c4.258-1.016 8.632 1.532 9.696 5.828l16.008 63.996a8.01 8.01 0 0 1-7.766 9.938zM647.99 480.002a7.994 7.994 0 0 1-6.656-3.562l-31.996-47.998a8 8 0 0 1 2.218-11.092c3.638-2.454 8.624-1.468 11.092 2.218l31.998 47.998a8 8 0 0 1-6.656 12.436z" fill=""></path><path d="M679.988 512H168.02a7.994 7.994 0 0 1-7.998-8c0-4.42 3.578-8 7.998-8h511.968c4.422 0 8 3.578 8 8 0 4.422-3.578 8-8 8zM280.014 80.026h-79.996a7.994 7.994 0 0 1-7.998-8V40.03c0-4.422 3.578-8 7.998-8h79.996c4.422 0 8 3.578 8 8v31.998a7.994 7.994 0 0 1-8 7.998z m-71.996-15.998h63.996v-16h-63.996v16zM647.99 80.026h-79.994c-4.422 0-8-3.578-8-8V40.03c0-4.422 3.578-8 8-8h79.994c4.422 0 8 3.578 8 8v31.998a7.994 7.994 0 0 1-8 7.998z m-71.996-15.998h63.996v-16h-63.996v16zM519.998 64.028h-191.988a7.994 7.994 0 0 1-7.998-8c0-4.42 3.578-8 7.998-8h191.988c4.422 0 8 3.578 8 8 0 4.422-3.578 8-8 8zM647.99 719.988H200.018c-4.42 0-7.998-3.578-7.998-8s3.578-8 7.998-8h447.972c4.422 0 8 3.578 8 8s-3.578 8-8 8zM504 575.996h-159.99c-4.422 0-8-3.578-8-8v-15.998c0-4.422 3.578-8 8-8s8 3.578 8 8v7.998H496v-7.998c0-4.422 3.578-8 8-8s8 3.578 8 8v15.998c0 4.422-3.578 8-8 8zM823.98 416.006h-111.994c-4.422 0-8-3.578-8-8v-15.998c0-4.422 3.578-8 8-8s8 3.578 8 8v8h95.994v-8c0-4.422 3.578-8 8-8a7.994 7.994 0 0 1 7.998 8v15.998c0 4.422-3.578 8-7.998 8zM312.004 655.992a8.004 8.004 0 0 1-7.688-5.796l-31.998-111.994a7.996 7.996 0 0 1 5.5-9.888c4.226-1.25 8.68 1.234 9.89 5.482l31.998 111.994a8 8 0 0 1-5.5 9.89 7.68 7.68 0 0 1-2.202 0.312zM535.998 655.992a7.78 7.78 0 0 1-2.204-0.312 7.982 7.982 0 0 1-5.484-9.89l31.998-111.994c1.204-4.232 5.578-6.78 9.89-5.482a7.98 7.98 0 0 1 5.482 9.888l-31.996 111.994a7.986 7.986 0 0 1-7.686 5.796zM504 607.994h-159.99c-4.422 0-8-3.578-8-8a7.994 7.994 0 0 1 8-7.998H504c4.422 0 8 3.578 8 7.998 0 4.422-3.578 8-8 8zM535.998 767.984H312.012c-4.422 0-8-3.578-8-8s3.578-8 8-8h223.986c4.422 0 8 3.578 8 8s-3.578 8-8 8z" fill=""></path><path d="M312.012 767.984c-4.422 0-8-3.578-8-8v-15.998c0-4.422 3.578-8 8-8s8 3.578 8 8v15.998c0 4.422-3.578 8-8 8zM535.998 767.984c-4.422 0-8-3.578-8-8v-15.998c0-4.422 3.578-8 8-8s8 3.578 8 8v15.998c0 4.422-3.578 8-8 8zM280.014 543.998h-79.996a7.994 7.994 0 0 1-7.998-8 7.994 7.994 0 0 1 7.998-7.998h79.996c4.422 0 8 3.578 8 7.998 0 4.422-3.578 8-8 8zM647.99 543.998h-79.994c-4.422 0-8-3.578-8-8a7.994 7.994 0 0 1 8-7.998h79.994c4.422 0 8 3.578 8 7.998 0 4.422-3.578 8-8 8zM264.014 591.996h-63.996c-4.42 0-7.998-3.578-7.998-8s3.578-8 7.998-8h63.996c4.422 0 8 3.578 8 8s-3.578 8-8 8zM647.99 591.996h-63.996c-4.422 0-8-3.578-8-8s3.578-8 8-8h63.996c4.422 0 8 3.578 8 8s-3.578 8-8 8zM535.998 655.992H312.012c-4.422 0-8-3.578-8-8s3.578-8 8-8h223.986c4.422 0 8 3.578 8 8s-3.578 8-8 8zM216.018 1023.968c-13.234 0-23.998-10.766-23.998-23.998 0-4.422 3.578-8 7.998-8 4.422 0 8 3.578 8 8 0 4.404 3.586 7.998 8 7.998s8-3.594 8-7.998c0-4.422 3.578-8 7.998-8 4.422 0 8 3.578 8 8 0 13.234-10.766 23.998-23.998 23.998zM807.98 1023.968c-13.232 0-23.998-10.766-23.998-23.998 0-4.422 3.578-8 8-8s8 3.578 8 8a8.014 8.014 0 0 0 7.998 7.998c4.406 0 8-3.594 8-7.998 0-4.422 3.578-8 8-8a7.994 7.994 0 0 1 7.998 8c0 13.234-10.764 23.998-23.998 23.998zM855.978 288.014h-175.99a7.994 7.994 0 0 1-7.998-8c0-4.42 3.578-8 7.998-8h175.99c4.422 0 8 3.578 8 8 0 4.422-3.578 8-8 8zM855.978 719.988h-175.99c-4.42 0-7.998-3.578-7.998-8s3.578-8 7.998-8h175.99c4.422 0 8 3.578 8 8s-3.578 8-8 8zM855.978 512h-175.99a7.994 7.994 0 0 1-7.998-8c0-4.42 3.578-8 7.998-8h175.99c4.422 0 8 3.578 8 8 0 4.422-3.578 8-8 8zM807.98 48.028h-79.994c-4.422 0-8-3.578-8-8 0-4.422 3.578-8 8-8h79.994c4.422 0 8 3.578 8 8 0 4.422-3.578 8-8 8zM791.982 80.026h-47.998a7.994 7.994 0 0 1-7.998-8c0-4.422 3.578-8 7.998-8h47.998c4.422 0 8 3.578 8 8 0 4.422-3.578 8-8 8zM727.986 671.99c-4.422 0-8-3.578-8-8v-79.994c0-4.422 3.578-8 8-8s8 3.578 8 8v79.994c0 4.422-3.578 8-8 8zM807.98 671.99a7.994 7.994 0 0 1-7.998-8v-79.994c0-4.422 3.578-8 7.998-8 4.422 0 8 3.578 8 8v79.994c0 4.422-3.578 8-8 8z" fill=""></path><path d="M727.986 607.994h-16c-4.422 0-8-3.578-8-8a7.994 7.994 0 0 1 8-7.998h16c4.422 0 8 3.578 8 7.998 0 4.422-3.578 8-8 8zM823.98 607.994h-16a7.994 7.994 0 0 1-7.998-8 7.994 7.994 0 0 1 7.998-7.998h16a7.994 7.994 0 0 1 7.998 7.998c0 4.422-3.578 8-7.998 8zM807.98 671.99h-79.994c-4.422 0-8-3.578-8-8a7.994 7.994 0 0 1 8-7.998h79.994c4.422 0 8 3.578 8 7.998 0 4.422-3.578 8-8 8zM767.982 607.994c-13.232 0-23.998-10.766-23.998-23.998 0-4.422 3.578-8 8-8s8 3.578 8 8c0 4.406 3.594 8 7.998 8 4.406 0 8-3.594 8-8 0-4.422 3.578-8 8-8s8 3.578 8 8c0 13.232-10.766 23.998-24 23.998zM551.996 288.014H296.012a7.994 7.994 0 0 1-7.998-8c0-4.42 3.578-8 7.998-8h255.984c4.422 0 8 3.578 8 8 0 4.422-3.578 8-8 8zM504 336.01h-159.99c-4.422 0-8-3.578-8-8 0-4.422 3.578-8 8-8H504c4.422 0 8 3.578 8 8 0 4.422-3.578 8-8 8z" fill=""></path></g></svg>
                    </span>
                    <div class="metric-info">
                        <h3>ATM Em Alerta</h3>
                        <div class="ATM_Alerta"></div>
                    </div>
                </div>

            </div>

            <h1>Jira</h1>

            <div class="charts-grid">

                <div class="container_jira container chart-card employees-by-role-bar full-width">
                    <h3>Chamados em Aberto no jira</h3>
                    <div class="chart-container">
                        <div class="kpi_metrica">
                        </div>
                    </div>
                </div>


                <div class="grafico chart-card employees-status">
                    <h3>Panorama Geral Tickets</h3>
                    <div class="chart-container">
                        <div id="myChart"></div>
                    </div>
                </div>
            </div>
            <h1>Componentes</h1>



            <div class="graficBarra charts-grid">

                <div class=" containerBarra container_jira container chart-card employees-by-role-bar full-width">
                    <h3> Metricas Componentes </h3>
                    <div>
                        <div id="kpi_metrica">
                            <div id="chart"></div>
                        </div>
                    </div>
                </div>


                <div class="chart-card employees-status">
                    <h3>Insights Gerado Por Inteligencia Artificial</h3>
                    <div class="iachart-container">
                        <div class="insights-container"></div>
                            <svg width="179px" height="179px" viewBox="0 0 24 24" data-name="025_SCIENCE" id="_025_SCIENCE" xmlns="http://www.w3.org/2000/svg" fill="#ffffff" stroke="#ffffff"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" stroke="#CCCCCC" stroke-width="0.288"></g><g id="SVGRepo_iconCarrier"><defs><style>.cls-1{fill:#ffffff;}</style></defs><path class="cls-1" d="M9,15a1,1,0,0,1-1-1V12a1,1,0,0,1,2,0v2A1,1,0,0,1,9,15Z"></path><path class="cls-1" d="M15,15a1,1,0,0,1-1-1V12a1,1,0,0,1,2,0v2A1,1,0,0,1,15,15Z"></path><path class="cls-1" d="M6,8a1,1,0,0,1-.71-.29l-3-3A1,1,0,0,1,3.71,3.29l3,3a1,1,0,0,1,0,1.42A1,1,0,0,1,6,8Z"></path><path class="cls-1" d="M18,8a1,1,0,0,1-.71-.29,1,1,0,0,1,0-1.42l3-3a1,1,0,1,1,1.42,1.42l-3,3A1,1,0,0,1,18,8Z"></path><path class="cls-1" d="M21,20H3a1,1,0,0,1-1-1V14.5a10,10,0,0,1,20,0V19A1,1,0,0,1,21,20ZM4,18H20V14.5a8,8,0,0,0-16,0Z"></path></g></svg>
                    </div>
                </div>
            </div>

            <h1>Gráfico de analise</h1>
            <div class=" graficoBolhacontainer  ">
                <div class=" graficoBolha ">
                    <div id="kpi_metrica-bubble">
                        <div id="bubble"></div>
                    </div>
                </div>
            </div>
            <div class="metrics-container container_bottum">

                <div class="perosna-kpi kpi-analitica">
                    <span class="material-symbols-outlined kpi-icon-analitica-mediana">
                    </span>
                    <div class="metric-info">
                        
                        <div class="classCompontes-analitica"></div>
                    </div>
                </div>

                <div class="perosna-kpi kpi-analitica">
                    <span class="material-symbols-outlined kpi-icon-analitica-mediana-cpu">
                    </span>
                    <div class="metric-info">
                        
                        <div class="classCompontes-analitica-cpu"></div>
                    </div>
                </div>

                <div class="perosna-kpi kpi-analitica">
                    <span class="material-symbols-outlined kpi-icon-analitica-mediana-rede">
                    </span>
                    <div class="metric-info">
                        <div class="classCompontes-analitica-rede"></div>
                    </div>
                </div>
                <div class="perosna-kpi kpi-analitica">
                    <span class="material-symbols-outlined kpi-icon-analitica-mediana-disco">
                    </span>
                    <div class="metric-info">
                        <div class="classComponentes-analitica-disco"></div>
                    </div>
                </div>

            </div>
        </div>









        <div id="meuModalJira" class="modal-container" style="display: none;">
            <div class="modal-content">
                <span class="fechar" onclick="fecharModal()">&times;</span>
                <div id="conteudoModal"></div>
                <svg fill="#ffffff" height="200px" width="200px" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" xml:space="preserve" stroke="#ffffff"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g> <g> <g> <path d="M389.333,64h-74.667V10.667C314.667,4.8,309.867,0,304,0h-96c-5.867,0-10.667,4.8-10.667,10.667V64h-74.667 c-17.707,0-32,14.293-32,32v384c0,17.707,14.293,32,32,32h266.667c17.707,0,32-14.293,32-32V96 C421.333,78.293,407.04,64,389.333,64z M218.667,21.333h74.667V64h-74.667V21.333z M400,480c0,5.867-4.8,10.667-10.667,10.667 H122.667c-5.867,0-10.667-4.8-10.667-10.667V96c0-5.867,4.8-10.667,10.667-10.667h266.667C395.2,85.333,400,90.133,400,96V480z"></path> <path d="M321.387,271.787l-45.333-12.8l26.88-92.16c0.747-2.453-0.427-5.013-2.667-6.187c-2.24-1.173-5.013-0.64-6.72,1.28 l-94.933,111.36c-1.173,1.387-1.6,3.307-1.067,5.013s1.92,3.093,3.733,3.627l45.013,12.693l-38.08,103.467 c-0.96,2.453,0.107,5.227,2.347,6.507c2.24,1.28,5.12,0.853,6.933-1.173l106.56-122.88c1.173-1.387,1.6-3.307,1.067-5.013 C324.587,273.707,323.2,272.32,321.387,271.787z"></path> </g> </g> </g> </g></svg>
            </div>
        </div>
</body>

</html>

<script>





    b_usuario.innerHTML = sessionStorage.NOME_USUARIO;
    graficoPizza = null;

    let dataPadrao = {
        day: "2-digit",
        month: "2-digit",
        year: "numeric",
        hour: "2-digit",
        minute: "2-digit"
    };


    let dadosDoBucket = [];
    let bubble;


    async function kpiGraficoAnalise(
        ram,
        cpu,
        disco,
        perda,
        bytesRec,
        bytesEnv) {
        const kpi_icon_analitica = document.querySelector('.kpi-icon-analitica-mediana');
        const kpi_icon_analitica_mediana_cpu = document.querySelector('.kpi-icon-analitica-mediana-cpu');
        const kpi_icon_analitica_mediana_rede = document.querySelector('.kpi-icon-analitica-mediana-rede');
        const kpi_icon_analitica_mediana_disco = document.querySelector('.kpi-icon-analitica-mediana-disco')

        kpi_icon_analitica_mediana_disco.innerHTML=`
        <svg fill="#ffffff" viewBox="0 0 64 64" data-name="Layer 1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" stroke="#ffffff"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><title></title><path d="M53.86,51.8H10.14a1.5,1.5,0,0,1-1.5-1.5V37.45a1.5,1.5,0,0,1,1.5-1.5H25.46a1.5,1.5,0,0,1,1.5,1.5V39.8H37V37.45a1.5,1.5,0,0,1,1.5-1.5H53.86a1.5,1.5,0,0,1,1.5,1.5V50.3A1.5,1.5,0,0,1,53.86,51.8Zm-42.22-3H52.36V39H40V41.3a1.5,1.5,0,0,1-1.5,1.5H25.46A1.5,1.5,0,0,1,24,41.3V39H11.64Z"></path><path d="M38.54,42.8H25.46A1.5,1.5,0,0,1,24,41.3V39H10.14a1.53,1.53,0,0,1-1.25-.67,1.49,1.49,0,0,1-.13-1.42l10-23.75a1.5,1.5,0,0,1,1.38-.91H45.86a1.5,1.5,0,0,1,1.42,1l8,23.75a1.48,1.48,0,0,1-.2,1.35,1.52,1.52,0,0,1-1.22.63H40V41.3A1.5,1.5,0,0,1,38.54,42.8ZM27,39.8H37V37.45a1.5,1.5,0,0,1,1.5-1.5H51.77l-7-20.75H21.14L12.4,36H25.46a1.5,1.5,0,0,1,1.5,1.5Z"></path></g></svg>`

        kpi_icon_analitica_mediana_rede.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#FFFFFF"><path d="M177-259q-59-62-91-139.5T54-560q0-84 31.5-162.5T177-861l47 47q-49 51-77 116.5T119-560q0 72 28 137.5T224-306l-47 47Zm105-105q-39-38-60-89.5T201-560q0-55 21-106.5t60-89.5l46 45q-30 30-45.5 69T267-560q0 43 15 81.5t46 68.5l-46 46Zm153 259v-360q-29-14-45-39t-16-56q0-45 30.5-76t75.5-31q45 0 76 31t31 76q0 31-16.5 56T526-465v360h-91Zm243-259-45-46q30-30 45.5-68.5T694-560q0-43-16-81.5T633-711l45-45q39 38 60.5 89.5T760-560q1 55-21 106t-61 90Zm105 105-47-47q49-51 78-116.5T843-560q0-72-29-137.5T736-814l46-47q59 60 92.5 138.5T908-560q0 84-33 161.5T783-259Z"/></svg>`
        kpi_icon_analitica_mediana_cpu.innerHTML =`<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M7 10C7 8.58579 7 7.87868 7.43934 7.43934C7.87868 7 8.58579 7 10 7H14C15.4142 7 16.1213 7 16.5607 7.43934C17 7.87868 17 8.58579 17 10V14C17 15.4142 17 16.1213 16.5607 16.5607C16.1213 17 15.4142 17 14 17H10C8.58579 17 7.87868 17 7.43934 16.5607C7 16.1213 7 15.4142 7 14V10Z" stroke="#ffffff" stroke-width="1.5"></path> <path d="M12.4286 10L11 12H13L11.5714 14" stroke="#ffffff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M4 12C4 8.22876 4 6.34315 5.17157 5.17157C6.34315 4 8.22876 4 12 4C15.7712 4 17.6569 4 18.8284 5.17157C20 6.34315 20 8.22876 20 12C20 15.7712 20 17.6569 18.8284 18.8284C17.6569 20 15.7712 20 12 20C8.22876 20 6.34315 20 5.17157 18.8284C4 17.6569 4 15.7712 4 12Z" stroke="#ffffff" stroke-width="1.5"></path> <path d="M4 12H2" stroke="#ffffff" stroke-width="1.5" stroke-linecap="round"></path> <path d="M22 12H20" stroke="#ffffff" stroke-width="1.5" stroke-linecap="round"></path> <path d="M4 9H2" stroke="#ffffff" stroke-width="1.5" stroke-linecap="round"></path> <path d="M22 9H20" stroke="#ffffff" stroke-width="1.5" stroke-linecap="round"></path> <path d="M4 15H2" stroke="#ffffff" stroke-width="1.5" stroke-linecap="round"></path> <path d="M22 15H20" stroke="#ffffff" stroke-width="1.5" stroke-linecap="round"></path> <path d="M12 20L12 22" stroke="#ffffff" stroke-width="1.5" stroke-linecap="round"></path> <path d="M12 2L12 4" stroke="#ffffff" stroke-width="1.5" stroke-linecap="round"></path> <path d="M9 20L9 22" stroke="#ffffff" stroke-width="1.5" stroke-linecap="round"></path> <path d="M9 2L9 4" stroke="#ffffff" stroke-width="1.5" stroke-linecap="round"></path> <path d="M15 20L15 22" stroke="#ffffff" stroke-width="1.5" stroke-linecap="round"></path> <path d="M15 2L15 4" stroke="#ffffff" stroke-width="1.5" stroke-linecap="round"></path> </g></svg>`

        kpi_icon_analitica.innerHTML = `
                    <svg fill="#ffffff" height="200px" width="200px" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 299.92 299.92" xml:space="preserve" stroke="#ffffff"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g> <g> <g> <path d="M293.4,65.2H6.52C2.914,65.2,0,68.114,0,71.72v117.36c0,3.606,2.914,6.52,6.52,6.52h6.52v32.6 c0,3.606,2.914,6.52,6.52,6.52h260.8c3.606,0,6.52-2.914,6.52-6.52v-32.6h6.52c3.606,0,6.52-2.914,6.52-6.52V71.72 C299.92,68.114,297.006,65.2,293.4,65.2z M273.84,221.68h-19.56H228.2h-26.08h-26.08h-26.08h-26.08H97.8H71.72H45.64H26.08V195.6 h19.56h26.08H97.8h26.08h26.08h26.08h26.08h26.08h26.08h19.56V221.68z M286.88,182.56h-6.52H19.56h-6.52V78.24h273.84V182.56z"></path> <path d="M32.6,169.52h39.12c3.606,0,6.52-2.914,6.52-6.52V97.8c0-3.606-2.914-6.52-6.52-6.52H32.6c-3.606,0-6.52,2.914-6.52,6.52 V163C26.08,166.606,28.994,169.52,32.6,169.52z M39.12,104.32H65.2v52.16H39.12V104.32z"></path> <path d="M97.8,169.52h39.12c3.606,0,6.52-2.914,6.52-6.52V97.8c0-3.606-2.914-6.52-6.52-6.52H97.8c-3.606,0-6.52,2.914-6.52,6.52 V163C91.28,166.606,94.194,169.52,97.8,169.52z M104.32,104.32h26.08v52.16h-26.08V104.32z"></path> <path d="M163,169.52h39.12c3.606,0,6.52-2.914,6.52-6.52V97.8c0-3.606-2.914-6.52-6.52-6.52H163c-3.606,0-6.52,2.914-6.52,6.52 V163C156.48,166.606,159.394,169.52,163,169.52z M169.52,104.32h26.08v52.16h-26.08V104.32z"></path> <path d="M228.2,169.52h39.12c3.606,0,6.52-2.914,6.52-6.52V97.8c0-3.606-2.914-6.52-6.52-6.52H228.2 c-3.606,0-6.52,2.914-6.52,6.52V163C221.68,166.606,224.594,169.52,228.2,169.52z M234.72,104.32h26.08v52.16h-26.08V104.32z"></path> <path d="M52.16,215.16v-13.04c0-3.606-2.914-6.52-6.52-6.52c-3.606,0-6.52,2.914-6.52,6.52v13.04c0,3.606,2.914,6.52,6.52,6.52 C49.246,221.68,52.16,218.766,52.16,215.16z"></path> <path d="M78.24,215.16v-13.04c0-3.606-2.914-6.52-6.52-6.52c-3.606,0-6.52,2.914-6.52,6.52v13.04c0,3.606,2.914,6.52,6.52,6.52 C75.326,221.68,78.24,218.766,78.24,215.16z"></path> <path d="M104.32,215.16v-13.04c0-3.606-2.914-6.52-6.52-6.52c-3.606,0-6.52,2.914-6.52,6.52v13.04c0,3.606,2.914,6.52,6.52,6.52 C101.406,221.68,104.32,218.766,104.32,215.16z"></path> <path d="M130.4,215.16v-13.04c0-3.606-2.914-6.52-6.52-6.52c-3.606,0-6.52,2.914-6.52,6.52v13.04c0,3.606,2.914,6.52,6.52,6.52 C127.486,221.68,130.4,218.766,130.4,215.16z"></path> <path d="M156.48,215.16v-13.04c0-3.606-2.914-6.52-6.52-6.52s-6.52,2.914-6.52,6.52v13.04c0,3.606,2.914,6.52,6.52,6.52 S156.48,218.766,156.48,215.16z"></path> <path d="M182.56,215.16v-13.04c0-3.606-2.914-6.52-6.52-6.52c-3.606,0-6.52,2.914-6.52,6.52v13.04c0,3.606,2.914,6.52,6.52,6.52 C179.646,221.68,182.56,218.766,182.56,215.16z"></path> <path d="M208.64,215.16v-13.04c0-3.606-2.914-6.52-6.52-6.52c-3.606,0-6.52,2.914-6.52,6.52v13.04c0,3.606,2.914,6.52,6.52,6.52 C205.726,221.68,208.64,218.766,208.64,215.16z"></path> <path d="M234.72,215.16v-13.04c0-3.606-2.914-6.52-6.52-6.52c-3.606,0-6.52,2.914-6.52,6.52v13.04c0,3.606,2.914,6.52,6.52,6.52 C231.806,221.68,234.72,218.766,234.72,215.16z"></path> <path d="M260.8,215.16v-13.04c0-3.606-2.914-6.52-6.52-6.52c-3.606,0-6.52,2.914-6.52,6.52v13.04c0,3.606,2.914,6.52,6.52,6.52 C257.886,221.68,260.8,218.766,260.8,215.16z"></path> </g> </g> </g> </g></svg>`


        const classCompontes_analitica = document.querySelector('.classCompontes-analitica');
        classCompontes_analitica.innerHTML = "";

        const classCompontes_analitica_cpu = document.querySelector('.classCompontes-analitica-cpu');
        classCompontes_analitica_cpu.innerHTML="";

        
        const classCompontes_analitica_rede = document.querySelector('.classCompontes-analitica-rede');
        classCompontes_analitica_rede.innerHTML=""
        
        const classComponentes_analitica_disco = document.querySelector('.classComponentes-analitica-disco');
        classComponentes_analitica_disco.innerHTML=""

        fetch("/componentes/buscarValoresComponentes", {
            method: "GET"
        }).then(Response => {
            return Response.json();
        }).then(respostaBDComponentes => {

            medianaRam = ss.median(ram)
            medianaCpu = ss.median(cpu)
            medianaDisco = ss.median(disco)
            medianaBytesPerca = ss.median(perda)
            medianaBytesReceb = ss.median(bytesRec)
            medianaBytesEnviado = ss.median(bytesEnv)




            respostaBDComponentes.forEach(componentesBanco => {

                nome_componente = componentesBanco.Nome_Componente

               
                if (nome_componente === "RAM") {
                    valorRamParametrizado = parseFloat(componentesBanco.Valor_Parametrizado)

                    porcentagem = ((medianaRam - valorRamParametrizado) / medianaRam) * 100;
                    refatoradoPorcentagem = porcentagem.toFixed(2)

                    if (refatoradoPorcentagem == valorRamParametrizado) {
                        classCompontes_analitica.innerHTML = `
                        <div class="infoMetrica_KPI" style="color:green;">
                        Ram: ${refatoradoPorcentagem}%  <svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#75FB4C"><path d="m124-222-65-64 317-316 167 167 204-207H628v-92h274v275h-91v-117L542-305 375-472 124-222Z"/></svg></div>
                    `
                    } else {
                        classCompontes_analitica.innerHTML = `
                      <div class="infoMetrica_KPI" style="color:red;">
                        Ram: ${refatoradoPorcentagem}%  <svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#EA3323"><path d="M628-222v-91h119L543-519 376-352 59-669l65-65 251 252 167-167 269 270v-116h91v273H628Z"/></svg></div>
                        `
                    }
                    return
                }
                
                if(nome_componente === "CPU"){
                    valorCpuParametrizado = parseFloat(componentesBanco.Valor_Parametrizado)
                    porcentagemCpu = ((medianaCpu - valorCpuParametrizado)/medianaCpu) *100;
                    refatoracaoCPU = porcentagemCpu.toFixed(0)
                    
                    if(refatoracaoCPU == valorCpuParametrizado){
                         
                            classCompontes_analitica_cpu.innerHTML=`
                            <div class="infoMetrica_KPI" style="color:green;">
                        CPU: ${refatoracaoCPU}%  <svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#75FB4C"><path d="m124-222-65-64 317-316 167 167 204-207H628v-92h274v275h-91v-117L542-305 375-472 124-222Z"/></svg></div>`
                        }else{
                            classCompontes_analitica_cpu.innerHTML=`
                            <div class="infoMetrica_KPI" style="color:red;">
                        CPU: ${refatoracaoCPU}%  <svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#EA3323"><path d="M628-222v-91h119L543-519 376-352 59-669l65-65 251 252 167-167 269 270v-116h91v273H628Z"/></svg></div>
                            `
                        }
                        return
                    }
                    if(nome_componente.includes("Rede")){
                         valorRedeParametro = parseFloat(componentesBanco.Valor_Parametrizado)
                        porcentagemRede = ((medianaBytesEnviado - valorRedeParametro)/medianaBytesEnviado) *100;
                        refatoradoRede = porcentagemRede.toFixed(0)
                        
                       
                        
                        if(refatoradoRede === valorRedeParametro){
                             classCompontes_analitica_rede.innerHTML=`
                            <div class="infoMetrica_KPI" style="color:green;">
                        REDE: ${refatoradoRede}%  <svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#75FB4C"><path d="m124-222-65-64 317-316 167 167 204-207H628v-92h274v275h-91v-117L542-305 375-472 124-222Z"/></svg></div>
                        `
                        }else if(refatoradoRede != valorRedeParametro){
                             classCompontes_analitica_rede.innerHTML=`
                            <div class="infoMetrica_KPI" style="color:red;">
                        REDE: ${refatoradoRede}%  <svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#EA3323"><path d="M628-222v-91h119L543-519 376-352 59-669l65-65 251 252 167-167 269 270v-116h91v273H628Z"/></svg></div>
                        `
                        }
                        return
                    }
                    if(nome_componente === 'DISCO'){
                        valorDiscoParametro = parseFloat(componentesBanco.Valor_Parametrizado)
                        porcentagemDisco = ((medianaDisco - valorDiscoParametro)/medianaDisco)*100;
                        refatorandoDisco = porcentagemDisco.toFixed(0)
                        console.log(valorDiscoParametro)
                        console.log(refatorandoDisco)
                        if(refatorandoDisco === valorDiscoParametro ){
                            classComponentes_analitica_disco.innerHTML=`
                            <div class="infoMetrica_KPI" style="color:green;">
                        DISCO: ${refatorandoDisco}%  <svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#75FB4C"><path d="m124-222-65-64 317-316 167 167 204-207H628v-92h274v275h-91v-117L542-305 375-472 124-222Z"/></svg></div>
                        `
                        }else if(refatorandoDisco != valorDiscoParametro ){
                            classComponentes_analitica_disco.innerHTML=`
                            <div class="infoMetrica_KPI" style="color:red;">
                        DISCO: ${refatorandoDisco}%  <svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#EA3323"><path d="M628-222v-91h119L543-519 376-352 59-669l65-65 251 252 167-167 269 270v-116h91v273H628Z"/></svg></div>
                        `
                        }                        
                    }

            });

        })

    }





    async function lerCsvBucket() {
        const bucketUrl = "https://client-blackscreen.s3.us-east-1.amazonaws.com";
        const pasta = "Maquina/";



        const responseList = await fetch(`${bucketUrl}?list-type=2&prefix=${pasta}`);
        if (!responseList.ok) throw new Error("Erro ao listar bucket");

        const xmlText = await responseList.text();
        const parser = new DOMParser();
        const xmlDoc = parser.parseFromString(xmlText, "text/xml");

        const conteudos = xmlDoc.getElementsByTagName("Contents");
        const urlsParaBaixar = [];

        for (let i = 0; i < conteudos.length; i++) {
            const key = conteudos[i].getElementsByTagName("Key")[0].textContent;
            if (key.endsWith(".csv")) {
                urlsParaBaixar.push(`${bucketUrl}/${key}`);
            }
        }

        const requests = urlsParaBaixar.map(url => fetch(url).then(res => res.text()));
        const conteudosClient = await Promise.all(requests);
        let resultadoFinal = [];

        conteudosClient.forEach(respostaBucket => {
            var csv = respostaBucket.trim().split("\n");
            var headers = csv[0].split(";");
            for (var i = 1; i < csv.length; i++) {
                var obj = {};
                var linhaAtual = csv[i].replace('\r', '').split(";");

                if (linhaAtual.length === headers.length) {
                    for (var j = 0; j < headers.length; j++) {
                        var chave = headers[j].trim();
                        var valor = linhaAtual[j];
                        obj[chave] = valor;
                    }
                    resultadoFinal.push(obj);
                }
            }
        });

        dadosDoBucket = resultadoFinal;
        const ram = dadosDoBucket.map(item => parseFloat(item.ram));
        const cpu = dadosDoBucket.map(item => parseFloat(item.cpu));
        const disco = dadosDoBucket.map(item => parseFloat(item.disco));
        const perda = dadosDoBucket.map(item => parseFloat(item.pacotes_perdidos));
        const bytesRec = dadosDoBucket.map(item => parseFloat(item.bytes_recebidos));
        const bytesEnv = dadosDoBucket.map(item => parseFloat(item.bytes_enviados));


        const montarSerie = (arrayX, arrayY) => {
            return arrayX.map((valorX, index) => [valorX, arrayY[index]]);
        };

        if (bubble) {
            bubble.destroy();

        }
        var options = {
            series: [
                {
                    name: "CPU (vs RAM)",
                    data: montarSerie(cpu, ram)
                }

            ],
            chart: {
                width: 1450,
                height: 700,

                type: 'scatter',
                zoom: {
                    enabled: true,
                    type: 'xy'
                }
            },
            xaxis: {
                title: {
                    text: 'Uso da CPU em %'
                },
                tickAmount: 10,
                labels: {
                    formatter: function (val) {
                        return parseFloat(val).toFixed(1)
                    }
                }
            },
            yaxis: {
                title: {
                    text: 'Uso de RAM em %'
                },
                tickAmount: 10
            },
            markers: {
                size: 5,
                fillOpacity: 0.6,
                strokeWidth: 0
            },
            tooltip: {
                shared: false,
                intersect: true,
                y: {
                    formatter: function (val) {
                        return val + "% (RAM)"
                    }
                }
            },
            legend: {
                position: 'top',
                horizontalAlign: 'left'
            }
        };


        bubble = new ApexCharts(document.querySelector("#bubble"), options);

        bubble.render();

        await kpiGraficoAnalise(
            ram,
            cpu,
            disco,
            perda,
            bytesRec,
            bytesEnv
        )
    }


    function buscarPorComponenteDash() {
        fetch('http://98.83.124.125:8080/chamadosJira', {
            method: "GET"
        }).then(Response => {
            return Response.json();
        }).then(respostaJira => {

            let ArrayChamados = [];
            const respostaDoJira = respostaJira.issues;

            const hoje = new Date();

            const inicioSemanaAtual = new Date(hoje);
            inicioSemanaAtual.setDate(hoje.getDate() - hoje.getDay());
            inicioSemanaAtual.setHours(0, 0, 0, 0);

            const inicioSemanaAnterior = new Date(inicioSemanaAtual);
            inicioSemanaAnterior.setDate(inicioSemanaAtual.getDate() - 7);

            const fimSemanaAnterior = new Date(inicioSemanaAtual);
            fimSemanaAnterior.setMilliseconds(-1);

            respostaDoJira.forEach(dadosJira => {
                let nomeDoAtm = dadosJira.fields.description?.content?.[0]?.content?.[0]?.text || "Indefinido";

                let dataDeCriacao = new Date(dadosJira.fields.created);
                let nomeDoComponente = dadosJira.fields.summary;
                let status = dadosJira.fields.status.name;


                if (nomeDoComponente.toLowerCase().includes("testando via java")) return;

                if (nomeDoComponente.toLowerCase().includes("ram")) nomeDoComponente = 'RAM';
                else if (nomeDoComponente.toLowerCase().includes("cpu")) nomeDoComponente = 'CPU';
                else if (nomeDoComponente.toLowerCase().includes("disco")) nomeDoComponente = 'DISCO';
                else if (nomeDoComponente.toLowerCase().includes("rede")) nomeDoComponente = 'REDE';
                else return;
                let periodo = null;
                if (dataDeCriacao >= inicioSemanaAtual && dataDeCriacao <= hoje) {
                    periodo = 'atual';
                } else if (dataDeCriacao >= inicioSemanaAnterior && dataDeCriacao <= fimSemanaAnterior) {
                    periodo = 'anterior';
                }

                if (periodo) {
                    ArrayChamados.push({
                        componente: nomeDoComponente,
                        periodo: periodo,
                        status: status
                    });
                }
            });

            const contagemPorComponente = {};

            ArrayChamados.forEach(chamado => {

                if (!contagemPorComponente[chamado.componente]) {
                    contagemPorComponente[chamado.componente] = { atual: 0, anterior: 0 };
                }

                if (chamado.periodo === 'atual') {
                    contagemPorComponente[chamado.componente].atual++;
                } else if (chamado.periodo === 'anterior') {
                    contagemPorComponente[chamado.componente].anterior++;
                }
            });

            const componentes = Object.keys(contagemPorComponente);
            const dadosSemanaAtual = componentes.map(comp => contagemPorComponente[comp].atual);
            const dadosSemanaAnterior = componentes.map(comp => contagemPorComponente[comp].anterior);

            var options = {
                series: [{
                    name: 'Semana Atual',
                    data: dadosSemanaAtual
                }, {
                    name: 'Semana Anterior',
                    data: dadosSemanaAnterior
                }],

                chart: {
                    type: 'bar',
                    height: 430,
                    background: '#f5f5f5',
                    borderRadius: '20px',
                    color: '#000'
                },
                plotOptions: {
                    bar: {
                        horizontal: true,
                        dataLabels: { position: 'top' },
                    }
                },
                dataLabels: {
                    enabled: false,
                    offsetX: -6,
                    style: { fontSize: '15px', colors: ['#fff'] }
                },
                stroke: { show: true, width: 1, colors: ['#fff'] },
                tooltip: { shared: true, intersect: false },
                xaxis: {
                    titel: {
                        text: 'Componentes',
                        style: {
                            color: '#000',
                            fontSize: '15px',
                            fontWeight: 600,
                            background: '#000'

                        }
                    }, categories: componentes
                },
                legend: { position: 'top', horizontalAlign: 'right' },
                colors: ['#004076', '#5C9BD5']


            }




            const chartElement = document.querySelector("#chart");
            if (chartElement) {
                chartElement.innerHTML = "";
                var chart = new ApexCharts(chartElement, options);
                chart.render();
            }
            if (typeof enviarDadosParaIA === 'function') {
                enviarDadosParaIA(ArrayChamados, componentes, dadosSemanaAtual, dadosSemanaAnterior);
            }

        }).catch(error => {
            console.error("Erro na requisição ou processamento:", error);
        });


    }
    /* function enviarDadosParaIA(dadosJira, componentes, dadosSemanaAtual, dadosSemanaAnterior) {
            fetch("http://localhost:3333/gemini/prompt", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    dadosJira: dadosJira,
                    componentes: componentes,
                    dadosSemanaAtual: dadosSemanaAtual,
                    dadosSemanaAnterior: dadosSemanaAnterior
                })
            })
                .then(response => response.json())
                .then(resultado => {
                    exibirInsights(resultado.insights);
                })
                .catch(error => {
                    console.error("Erro ao buscar insights do gemini", error);
                });
        }
        function exibirInsights(insights) {
            const container = document.querySelector('.insights-container');
            if (container) {
                container.innerHTML = `
                <div>
                    <h1>
                        Análise Técnica 
                    </h1>
                    <div class="insights_ia">
                        ${insights}
                    </div>
                    </div>
                    <h3>Todos os insights gerado por IA devem ser seguidos com responsábilidade e não dispensa a analise de um especialista. </h3>
            `;
            }
        }
       */

    function buscarDataEHoraChamados() {

        fetch('http://98.83.124.125:8080/chamadosJira', {
            method: "GET"
        }).then(Response => {
            return Response.json();
        }).then(respostaData => {

            const chamadoHora = respostaData.issues;


            const dataEHoraFormatada = new Intl.DateTimeFormat('pt-BR', dataPadrao);


            const classCompontes_alertas = document.querySelector('.classCompontes_alertas');


            const kpi_metrica = document.querySelector('.kpi_metrica');

            kpi_metrica.innerHTML = '';
            classCompontes_alertas.innerHTML = ""
            let totalDeChamadosAbertos = 0;
            let totalDeChamadosConcluidos = 0;
            let totalDeChamadosReabertos = 0;


            const chartElement = document.querySelector('#myChart');

            let statusAtual;
            let cores;

            chamadoHora.forEach(chamadosHora => {

                statusAtual = chamadosHora.fields.status.name;
                const nomeComponenteAlerta = chamadosHora.fields.summary;

                if (statusAtual === "Concluído") {
                    totalDeChamadosConcluidos++
                }

                const stringCriacao = chamadosHora.fields.created;
                const stringAlteracao = chamadosHora.fields.updated;


                const dataAtual = new Date();
                const objDataCriacao = new Date(stringCriacao);
                const objDataAtualizacao = new Date(stringAlteracao);
                const dataCriacao = dataEHoraFormatada.format(objDataCriacao);
                const dataUpdate = dataEHoraFormatada.format(objDataAtualizacao);

                const compHora = dataAtual - objDataCriacao;
                const milissegundosPorDia = 1000 * 60 * 60 * 24;
                const tempo = 5 * 60 * 1000;

                idMaquina = chamadosHora.fields.description.content[0].content[0].text;
                cores = [
                    'rgb(255,0,0)',

                    'rgba(0, 143, 251, 0.85)'
                ];

                if (statusAtual == "Aberto" || statusAtual == "Reaberto") {

                    if (compHora > tempo) {
                        const emDias = compHora / milissegundosPorDia;
                        const diasInteiros = Math.floor(emDias);

                        const chamadoDiv = document.createElement('div');
                        chamadoDiv.className = 'chamado-item';


                        chamadoDiv.innerHTML = `
                          <div class="info">
                            <div class="card-jira"role="button" onclick="abrirModal('${idMaquina}','${nomeComponenteAlerta}' , '${statusAtual}', '${diasInteiros}', '${dataCriacao}', '${dataUpdate}')">
                                <div class="chamado-titulo">${nomeComponenteAlerta} <svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#fff"><path d="M210-160v-60h61l84-277q6-19 21.5-31t35.5-12h136q20 0 35.5 12t21.5 31l84 277h61v60H210Zm125-60h290l-78-260H413l-78 260Zm115-440v-180h60v180h-60Zm235 98-43-43 128-127 42 42-127 128Zm55 192v-60h180v60H740ZM275-562 148-690l42-42 128 127-43 43ZM40-370v-60h180v60H40Zm440 150Z"/></svg></div>
                            <p>${idMaquina}</p>
                            </div>
                          </div>
                          `;
                        kpi_metrica.appendChild(chamadoDiv);

                        if (statusAtual == "Aberto") {
                            totalDeChamadosAbertos++
                        } else if (statusAtual == "Reaberto") {
                            totalDeChamadosReabertos++;
                        }


                    }
                }

            });
            if (statusAtual == "Concluído" || statusAtual == "Aberto" || statusAtual == "Reaberto") {
                chamadosTotais = 0;
                chamadosTotais += totalDeChamadosReabertos;
                chamadosTotais += totalDeChamadosAbertos;


                let chamadosGrafico =
                    [
                        chamadosTotais,
                        totalDeChamadosConcluidos
                    ]
                if (graficoPizza) {
                    graficoPizza.destroy();
                }

                var options = {
                    series: [chamadosGrafico[0], chamadosGrafico[1]],

                    chart: {
                        type: 'donut',
                        width: '380px',
                        height: '280px',
                        background: '# f5f5f5',
                        color: '#fff'
                    },

                    labels: ['Abertos e Reabertos', 'Concluídos'],
                    colors: cores,
                    legend: {
                        position: 'top'
                    },

                    title: {
                        text: 'Status dos Chamados',
                        align: 'center'
                    },

                    plotOptions: {
                        pie: {
                            donut: {
                                size: '65%',

                                labels: {
                                    show: true,
                                    total: {
                                        show: true,
                                        label: 'Total',
                                        fontSize: '15px',
                                        formatter: function (w) {
                                            return w.globals.series.reduce((a, b) => a + b, 0);
                                        }
                                    }
                                }
                            }
                        }
                    },

                    responsive: [{
                        breakpoint: 480,
                        options: {
                            chart: {
                                width: 200,
                                color: '#fff'
                            },
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }]
                };


                graficoPizza = new ApexCharts(chartElement, options);
                graficoPizza.render();

            }




            if (totalDeChamadosAbertos === 0 && totalDeChamadosReabertos === 0) {

                classCompontes_alertas.innerHTML = '<p class="sem-alertas">Nenhum chamado em alerta no momento.</p>';
            }
            else {
                totalDeChamadosAbertos += totalDeChamadosReabertos;
                classCompontes_alertas.innerHTML += `
            <div class="tituloAlerta">chamado(s) sem solução</div>
            <div class="infoAlerta">${totalDeChamadosAbertos}</div>
            `
            }

        })

    };
    function abrirModal(nomeComponenteAlerta, nome, status, dias, criacao, update, idMaquina) {
        const modal = document.getElementById('meuModalJira');
        const conteudo = document.getElementById('conteudoModal');
        const divSvg = document.querySelector('.divSvg')
        fetch('http://98.83.124.125:8080/chamadosJira', {
            method: 'PUTT',
            body: [,

            ]
        })
        let valorSvg = "";


        conteudo.innerHTML = `
        <div class="divSvg">${nome}</div>
        <p>${nomeComponenteAlerta}</p>
        <div class="chamado-detalhes">
            <p><strong>Status:</strong> ${status}</p>
            <p><strong>Dias em aberto:</strong> ${dias} dia(s)</p>
            <p><strong>Criado em:</strong> ${criacao}</p>
            <p><strong>Atualizado em:</strong> ${update}</p>
        </div>
    `;

        modal.style.display = 'flex';

    }
    function fecharModal() {
        document.getElementById('meuModalJira').style.display = 'none';
        window.location.reload()
    }

    window.onclick = function (event) {
        const modal = document.getElementById('meuModalJira');
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }

    function buscandoComponenteJiraKpi() {
        fetch('http://98.83.124.125:8080/chamadosJira', {
            method: "GET"

        }).then(Response => {

            return Response.json();

        }).then(resposta => {
            const chamados = resposta.issues;
            let cpu = 0;
            let ram = 0;
            let disco = 0;
            let rede = 0;
            let qtdAtm = 0;
            let atmId = []
            let componentes_nome = document.querySelector('.classCompontes');
            let ATM_Alerta = document.querySelector('.ATM_Alerta')
            chamados.forEach(chamado => {

                statusNome = chamado.fields.status.name;
                nomeComponente = chamado.fields.summary;
                chave = chamado.key;
                idMaquina = chamado.fields.description.content[0].content[0].text;

                idAnterio = "";
                if (idMaquina.includes("ID ATM:")) {
                    if (!atmId.includes(idMaquina)) {
                        atmId.push(idMaquina);


                        if (!idMaquina == idAnterio && statusNome.includes("Aberto")) {
                            qtdAtm++;
                            idAnterio = idMaquina;


                        } else if (!idMaquina == idAnterio && statusNome.includes("Reaberto")) {
                            qtdAtm++;
                            idAnterio = idMaquina;


                        }
                    }
                }

                if (statusNome == "Aberto" || statusNome == "Itens Pendentes") {
                    if (nomeComponente.includes("CPU") || nomeComponente.includes('cpu') || nomeComponente.includes('Cpu')) {
                        cpu++
                    }
                    else if (nomeComponente.includes("RAM") || nomeComponente.includes('ram') || nomeComponente.includes('Ram')) {
                        ram++
                    }
                    else if (nomeComponente.includes("DISCO") || nomeComponente.includes('disco') || nomeComponente.includes('Disco')) {
                        disco++
                    } else if (nomeComponente.includes("Rede") || nomeComponente.includes('REDE') || nomeComponente.includes('rede')) {
                        rede++
                    }


                }

                let ranking = [
                    { nome: 'CPU', valor: cpu, classe: 'componente1' },
                    { nome: 'RAM', valor: ram, classe: 'componente2' },
                    { nome: 'DISCO', valor: disco, classe: 'componente3' },
                    { nome: 'REDE', valor: rede, classe: 'componente4' }
                ];


                ranking.sort((a, b) => {
                    return b.valor - a.valor;
                });

                const container = document.querySelector('.classCompontes');

                container.innerHTML = '';


                for (const item of ranking) {
                    if (item.valor === 0) {
                        container.innerHTML += `
                        <h4 class="componente ${item.classe}">${item.nome}: ${item.valor}<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#75FB4C"><path d="M378-246 154-470l43-43 181 181 384-384 43 43-427 427Z"/></svg> </h4> `
                    } else if (item.valor < 10) {
                        container.innerHTML += `
                    <h4 class="componente ${item.classe}">${item.nome}: ${item.valor}  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#FFFF55"><path d="M400-240q-33 0-56.5-23.5T320-320v-50q-57-39-88.5-100T200-600q0-117 81.5-198.5T480-880q117 0 198.5 81.5T760-600q0 69-31.5 129.5T640-370v50q0 33-23.5 56.5T560-240H400Zm0-80h160v-92l34-24q41-28 63.5-71.5T680-600q0-83-58.5-141.5T480-800q-83 0-141.5 58.5T280-600q0 49 22.5 92.5T366-436l34 24v92Zm0 240q-17 0-28.5-11.5T360-120v-40h240v40q0 17-11.5 28.5T560-80H400Zm80-520Z"/></svg></h4>
                `;
                    } else if (item.valor >= 11) {
                        container.innerHTML += `
                    <h4 class="componente ${item.classe}">${item.nome}: ${item.valor}<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#EA3323"><path d="M200-160v-80h64l79-263q8-26 29.5-41.5T420-560h120q26 0 47.5 15.5T617-503l79 263h64v80H200Zm148-80h264l-72-240H420l-72 240Zm92-400v-200h80v200h-80Zm238 99-57-57 142-141 56 56-141 142Zm42 181v-80h200v80H720ZM282-541 141-683l56-56 142 141-57 57ZM40-360v-80h200v80H40Zm440 120Z"/></svg> </h4>
                `;
                    }
                }

            });

            if (qtdAtm > 0) {

                ATM_Alerta.innerHTML += `
                <h4 class="atms">ATM(S):  ${qtdAtm}</h4>
                `
            } else {
                ATM_Alerta.innerHTML += `
                <h4 class="atms"><strong>Nenhum ATM com alerta</strong></h4>
                `
            }

        })
    };
    setTimeout(lerCsvBucket, 2000)
    setTimeout(buscarDataEHoraChamados, 2000);
    setTimeout(buscandoComponenteJiraKpi, 2000);
    setTimeout(buscarPorComponenteDash, 2000);
    setTimeout(lerCsvBucket, 2000)   
</script>