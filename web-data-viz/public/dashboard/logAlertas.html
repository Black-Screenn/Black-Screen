<!DOCTYPE html>
<html lang="pt-br">

<head>
    <link rel="shortcut icon" href="../assets/imgs/blackscreenicon.ico" type="image/x-icon">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlackScreen | Alertas</title>

    <link rel="stylesheet" href="./../css/dashboards.css">
    <link rel="stylesheet" href="./../css/dashboardAlertas.css" />

    <script src="../js/sessao.js"></script>
    <script src="./../js/alerta.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=account_circle,home,local_atm,notifications,search_insights" />
    <link
        href="https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">
</head>

<body>

    <div class="janela">
        <div class="header-left">
            <img src="../assets/imgs/blackscreenlogo.png" alt="BlackScreen">

            <div class="hello">
                <h3>Bem vindo, <br><span id="b_usuario">usuário</span>!</h3>
            </div>

            <div class="links">
                <div class="btn-nav-white">
                    <a href="dashboard.html">
                        <span class="material-symbols-outlined">
                            home
                        </span>
                        <h3>
                            Ínicio
                        </h3>
                    </a>
                </div>
    
                <div class="btn-nav">
                    <a href="./logAlertas.html">
                        <span class="material-symbols-outlined">
                            notifications
                        </span>
                        <h3>
                            Alertas
                        </h3>
                    </a>
                </div>

                <div class="btn-nav-white">
                    <a href="atm.html">
                        <span class="material-symbols-outlined">
                            local_atm
                        </span>
                        <h3>
                            ATMs
                        </h3>
                    </a>
                </div>
    
                <div class="btn-nav-white">
                    <a href="./insight.html">
                        <span class="material-symbols-outlined">
                            search_insights
                        </span>
                        <h3>
                            Insights
                        </h3>
                    </a>
                </div>
    
                <div class="btn-nav-white">
                    <a href="./perfil.html">
                        <span class="material-symbols-outlined">
                            account_circle
                        </span>
                        <h3>
                            Meu Perfil
                        </h3>
                    </a>
                </div>
            </div>

            <div class="btn-logout" onclick="limparSessao()">
                <h3>Sair</h3>
            </div>

        </div>

    <div class="content-alertas">
        <div class="grid">
            <div class="card">
                <div class="resumo-hardware">
                    <h2>Alertas de Hardware (Última semana)</h2>
                    <p>Caixas sem rede: <span class="status-crit">5</span></p>
                    <p>Caixas ligados à mais que 7 dias: <span class="status-crit">4</span></p>
                    <p>CPU em uso máximo: <span class="status-crit">3</span></p>
                    <p>Disco acima de 90%: <span class="status-warn">2</span></p>
                </div>
            </div>
            <div class="card">
                <div class="resumo-processos">
                    <h2>Alertas de Processos (Última semana)</h2>
                    <p>Interfáce gráfica fora do ar: <span class="status-ok">0</span></p>
                    <p>Leitor de digitais inativo: <span class="status-warn">2</span></p>
                    <p>Dispenser de dinheiro sem notas: <span class="status-warn">3</span></p>
                    <p>Leitor de cartão inativo: <span class="status-crit">2</span></p>
                </div>
            </div>
            <div class="card ranking">
                <div class="alertas-atm">
                    <table>
                        <caption>Alertas por ATM</caption>
                        <tr><th>ATM</th><th>Alertas</th></tr>
                        <tr><td>ATM Paulista</td><td>100</td></tr>
                        <tr><td>ATM São José</td><td>82</td></tr>
                        <tr><td>ATM Iguatemi</td><td>77</td></tr>
                    </table>
                </div>
            </div>
        </div>

        <div class="grid">
            <div class="card">
                <h2>Alertas por dia da semana</h2>
                <div class="grafico"><canvas id="alertasSemanais"></canvas>
                </div>
            </div>
            <div class="graficoATM">
                <div class="card">
                    <select id="ipt_atmSelect">
                        <option value="#">Selecione um ATM</option>
                        <option value="atmPaulista">ATM Paulista</option>
                        <option value="atmSaoJose">ATM São José</option>
                        <option value="atmIguatemi">ATM Iguatemi</option>
                    </select>
                    <div class="grafico2"><canvas id="graficoAlertasATM"></canvas></div>
                </div>
            </div>
        </div>
    </div>
    </div>

    
</body>


</html>

<script>
    b_usuario.innerHTML = sessionStorage.NOME_USUARIO;
    
    const diasSemana = ['Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado', 'Domingo'];
    const ctx = document.getElementById('alertasSemanais').getContext('2d');

    const grafico1 = new Chart(ctx, {
        title: "Alertas por dia da semana",
        type: 'bar',
        data: {
            labels: diasSemana,
            datasets: [{
                label: 'Alertas de Hardware',
                data: [15, 20, 30, 18, 22, 25, 14],
                backgroundColor: '#007bff',
                borderWidth: 0
            },
            {
                label: 'Alertas de Processos',
                data: [11, 18, 16, 24, 19, 14, 13],
                backgroundColor: '#001c41',
                borderWidth: 0
            }
            ]
        },
        options: {
            scales: {
            x: {
                beginAtZero: true
            }
            },
            plugins: {
            legend: {
                position: 'bottom'
            }
            }
        }
    });


    const ctx1 = document.getElementById('graficoAlertasATM');
    
    const dadosATM = {
      atmPaulista: [10, 16, 12, 17, 16, 20, 9],
      atmSaoJose: [8, 12, 14, 17, 10, 10, 11],
      atmIguatemi: [8, 10, 20, 8, 15, 9, 7]
    };


    const grafico2 = new Chart(ctx1, {
        title: "Alertas totais por dia da semana",
        type: 'bar',
        data: {
            labels: diasSemana,
            datasets: [{
            label: 'Nº de alertas',
            data: [],
            backgroundColor: '#001c41'
            }]
        },
        options: {
            responsive: true,
            scales: {
            x: {
                beginAtZero: true
            }
            },
            plugins: {
            legend: {
                position: 'bottom'
            },
            title: { 
                display: true, 
                text: 'Alertas totais por dia da semana', 
                color: 'black', 
                font: { 
                    size: 18 
                } }
            }
        }
    });

    function atualizarDashboard() {
        const atm = ipt_atmSelect.value;
        let dados = [];
        if (atm == "#") {
            // Soma todos os ATMs
            for (let i = 0; i < dadosATM.atmPaulista.length; i++) {
            dados.push(
                dadosATM.atmPaulista[i] +
                dadosATM.atmSaoJose[i] +
                dadosATM.atmIguatemi[i]
            );
            }
        } else {
            dados = dadosATM[atm];
        }

        grafico2.data.datasets[0].data = dados;
        grafico2.update();
    }

    atualizarDashboard();
    ipt_atmSelect.addEventListener('change', atualizarDashboard);
</script>
